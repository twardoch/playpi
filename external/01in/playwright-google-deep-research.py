## This file needs to be adedpted to use playwrightauthor

import asyncio
import re

from playwright.async_api import Playwright, async_playwright, expect


async def run(playwright: Playwright) -> None:
    browser = await playwright.chromium.launch(headless=False)
    context = await browser.new_context()
    page = await context.new_page()
    ## We need to use playwrightauthor to login to Google Gemini
    ## We go to https://gemini.google.com/
    await page.goto("https://gemini.google.com/u/0/app")

    ## This is duplicate
    await page.get_by_role("textbox", name="Enter a prompt here").get_by_role("paragraph").click()
    await page.get_by_role("textbox", name="Enter a prompt here").get_by_role("paragraph").click()
    ## Here is the input panel where we enter the prompt and we choose the Deep Research option and we submit the research: <div _ngcontent-ng-c4202497522="" xapfileselectordropzone="" class="text-input-field ng-tns-c4202497522-6 with-toolbox-drawer height-expanded-past-single-line"><!----><!----><div _ngcontent-ng-c4202497522="" class="text-input-field_textarea-wrapper ng-tns-c4202497522-6" style="--chat-container-height: 497;"><div _ngcontent-ng-c4202497522="" class="text-input-field-main-area ng-tns-c4202497522-6"><div _ngcontent-ng-c4202497522="" class="text-input-field_textarea-inner ng-tns-c4202497522-6" style="height: 24px;"><!----><!----><rich-textarea _ngcontent-ng-c4202497522="" atmentions="" class="text-input-field_textarea ql-container ql-bubble ng-tns-c4202497522-6 enterprise ng-untouched ng-pristine ng-valid ng-star-inserted" _nghost-ng-c2053731484="" enterkeyhint="send" dir="ltr" style="--textarea-max-rows: 7; --chat-container-height: 497px;"><div class="ql-editor ql-blank textarea new-input-ui" data-gramm="false" contenteditable="true" role="textbox" aria-multiline="true" aria-label="Enter a prompt here" data-placeholder="Enter a prompt for Gemini"><p><br></p></div><div class="ql-clipboard" contenteditable="true" tabindex="-1"></div></rich-textarea><at-mentions-menu _nghost-ng-c1440345033="" class="ng-tns-c4202497522-6 ng-star-inserted"><mat-menu _ngcontent-ng-c1440345033="" class=""><!----></mat-menu></at-mentions-menu><!----><!----><!----><!----></div></div></div><div _ngcontent-ng-c4202497522="" class="leading-actions-wrapper ng-tns-c4202497522-6 ng-star-inserted"><div _ngcontent-ng-c4202497522="" class="uploader-button-container ng-tns-c4202497522-6 ng-star-inserted"><uploader-signed-out-tooltip _ngcontent-ng-c4202497522="" class="ng-tns-c4202497522-6" _nghost-ng-c208046529=""><!----></uploader-signed-out-tooltip><uploader _ngcontent-ng-c4202497522="" maticonprefix="" class="upload-button ng-tns-c4202497522-6" _nghost-ng-c15563704=""><div _ngcontent-ng-c15563704="" cdk-overlay-origin="" class="file-uploader ng-star-inserted"><div _ngcontent-ng-c15563704="" class="mat-mdc-tooltip-trigger mat-mdc-tooltip-disabled"><!----><button _ngcontent-ng-c15563704="" mat-icon-button="" color="primary" aria-label="Open upload file menu" class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base mat-mdc-tooltip-trigger upload-card-button open mat-primary _mat-animation-noopable ng-star-inserted" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-centered="" mat-ripple-loader-disabled="" jslog="188890;track:generic_click,impression,hover" aria-describedby="cdk-describedby-message-ng-1-3" cdk-describedby-host="ng-1"><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><mat-icon _ngcontent-ng-c15563704="" role="img" class="mat-icon notranslate gds-icon-l google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="add_2" fonticon="add_2"></mat-icon><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!----><!----><!----><button _ngcontent-ng-c15563704="" tabindex="-1" xapfileselectortrigger="" aria-hidden="true" data-test-id="hidden-local-image-upload-button" class="hidden-local-upload-button"></button><button _ngcontent-ng-c15563704="" tabindex="-2" xapfileselectortrigger="" aria-hidden="true" data-test-id="hidden-local-file-upload-button" class="hidden-local-file-upload-button"></button></uploader></div><!----><!----><!----><toolbox-drawer _ngcontent-ng-c4202497522="" _nghost-ng-c2419590215="" class="ng-tns-c2419590215-15 ng-tns-c4202497522-6 ng-star-inserted" style=""><div _ngcontent-ng-c2419590215="" class="toolbox-drawer-container ng-tns-c2419590215-15 ng-trigger ng-trigger-toolboxDrawerEnter" jslog="251251;track:impression"><!----><div _ngcontent-ng-c2419590215="" cdkoverlayorigin="" class="toolbox-drawer-button-container ng-tns-c2419590215-15 ng-star-inserted" style=""><!----><button _ngcontent-ng-c2419590215="" mat-button="" class="mdc-button mat-mdc-button-base toolbox-drawer-button toolbox-drawer-button-with-label mat-mdc-button ng-tns-c2419590215-15 mat-unthemed _mat-animation-noopable ng-star-inserted" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-disabled=""><span class="mat-mdc-button-persistent-ripple mdc-button__ripple"></span><mat-icon _ngcontent-ng-c2419590215="" role="img" fonticon="page_info" class="mat-icon notranslate gds-icon-l toolbox-drawer-button-icon google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="page_info"></mat-icon><span class="mdc-button__label"><span _ngcontent-ng-c2419590215="">Tools</span></span><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span><span class="mat-ripple mat-mdc-button-ripple"></span></button><!----><!----><!----><!----></div><!----><!----><!----></div></toolbox-drawer><!----><!----><!----><!----></div><!----><!----><div _ngcontent-ng-c4202497522="" class="trailing-actions-wrapper ng-tns-c4202497522-6"><!----><div _ngcontent-ng-c4202497522="" class="input-buttons-wrapper-bottom ng-tns-c4202497522-6"><div _ngcontent-ng-c4202497522="" class="mic-button-container ng-tns-c4202497522-6 ng-trigger ng-trigger-slide ng-star-inserted"><speech-dictation-mic-button _ngcontent-ng-c4202497522="" class="speech-dictation-mic-button ng-tns-c833376002-7 ng-tns-c4202497522-6 ng-star-inserted" _nghost-ng-c833376002="" style=""><button _ngcontent-ng-c833376002="" data-node-type="speech_dictation_mic_button" maticonsuffix="" mat-icon-button="" mattooltip="Use microphone" aria-label="Microphone" class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base mat-mdc-tooltip-trigger speech_dictation_mic_button ng-tns-c833376002-7 mat-unthemed _mat-animation-noopable" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-centered="" jslog="175863;track:generic_click,impression" aria-describedby="cdk-describedby-message-ng-1-4" cdk-describedby-host="ng-1"><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><div _ngcontent-ng-c833376002=""><mat-icon _ngcontent-ng-c833376002="" role="img" class="mat-icon notranslate ng-tns-c833376002-7 icon-filled gds-icon-l google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="mic" fonticon="mic"></mat-icon><!----><!----></div><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----></speech-dictation-mic-button><!----></div><!----><div _ngcontent-ng-c4202497522="" class="mat-mdc-tooltip-trigger send-button-container ng-tns-c4202497522-6 disabled inner mat-mdc-tooltip-disabled ng-star-inserted"><button _ngcontent-ng-c4202497522="" mat-icon-button="" class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base send-button ng-tns-c4202497522-6 submit mat-unthemed _mat-animation-noopable" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-centered="" aria-label="Send message" jslog="173899;track:generic_click,impression;BardVeMetadataKey:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[&quot;4af6c7f5da75d65d&quot;]];mutable:true" aria-disabled="true" tabindex="-1"><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><mat-icon _ngcontent-ng-c4202497522="" role="img" fonticon="send" class="mat-icon notranslate send-button-icon icon-filled gds-icon-xl google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="send"></mat-icon><!----><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button></div><!----><!----></div></div><!----></div>
    ## Here we enter the prompt, this prompt here is just an example :)
    await (
        page.locator("rich-textarea div")
        .nth(1)
        .fill(
            "Завдання: Ретельно дослідіть україномовні книги, які реально існують і містять поради щодо (1) типографіки (2) графічного дизайну (3) історії письма (4) книговидання (5) редакційного дизайну (6) історії та технологій друку (7) письмових систем, писемностей і мов (8) каліграфії.\n\n\nСформуйте документ із записами, розділеними крапкою з комою, у такому форматі (по одному запису в рядку):\n\n\n```\nISBN;Повне ім’я автора;Назва книги;Рік видання;Мова видання;Нотатки та примітки\n```\n\n\nВключайте лише книги, що реально існують, і лише ті, які загалом вважаються добрими. Перевірте це двічі."
        )
    )
    ## Here's another state, with another prompt, right before submitting: <input-container _ngcontent-ng-c4279487407="" class="input-gradient ng-tns-c637212676-2 ng-tns-c4279487407-1 ui-improvements-phase-1 ng-star-inserted" _nghost-ng-c637212676="" style=""><!----><!----><!----><!----><!----><div _ngcontent-ng-c637212676="" class="input-area-container ng-tns-c637212676-2 ng-trigger ng-trigger-inputAreaAnimation ng-star-inserted is-zero-state"><div _ngcontent-ng-c637212676="" class="contextual-actions-container ng-tns-c637212676-2 ng-star-inserted" style=""><contextual-actions _ngcontent-ng-c637212676="" class="ng-tns-c637212676-2" _nghost-ng-c1128526491=""><div _ngcontent-ng-c1128526491="" class="container hidden"><!----></div></contextual-actions></div><!----><file-drop-indicator _ngcontent-ng-c637212676="" _nghost-ng-c1934280174="" class="ng-tns-c1934280174-4 ng-tns-c637212676-2 ng-star-inserted" style=""><!----></file-drop-indicator><!----><!----><input-area-v2 _ngcontent-ng-c637212676="" _nghost-ng-c4202497522="" class="ng-tns-c4202497522-6 ng-tns-c637212676-2 ui-improvements-phase-1 with-toolbox-drawer ng-star-inserted" style=""><div _ngcontent-ng-c4202497522="" data-node-type="input-area" class="input-area ng-tns-c4202497522-6 with-toolbox-drawer is-zero-state"><!----><!----><div _ngcontent-ng-c4202497522="" xapfileselectordropzone="" class="text-input-field ng-tns-c4202497522-6 with-toolbox-drawer height-expanded-past-single-line pre-fullscreen"><!----><!----><div _ngcontent-ng-c4202497522="" class="text-input-field_textarea-wrapper ng-tns-c4202497522-6 pre-fullscreen" style="--chat-container-height: 497;"><div _ngcontent-ng-c4202497522="" class="text-input-field-main-area ng-tns-c4202497522-6"><div _ngcontent-ng-c4202497522="" class="text-input-field_textarea-inner ng-tns-c4202497522-6" style="height: 168px;"><!----><!----><!----><rich-textarea _ngcontent-ng-c4202497522="" class="text-input-field_textarea ql-container ql-bubble ng-tns-c4202497522-6 enterprise ng-untouched ng-dirty ng-valid ng-star-inserted" _nghost-ng-c2053731484="" style="--textarea-max-rows: 7; --chat-container-height: 497px;" enterkeyhint="send" dir="ltr"><div class="ql-editor textarea new-input-ui" data-gramm="false" contenteditable="true" role="textbox" aria-multiline="true" aria-label="Enter a prompt here" data-placeholder="Enter a prompt for Gemini"><p>Taak: Doe zorgvuldig onderzoek naar Nederlandstalige boeken die in het echt bestaan en advies geven over (1) typografie (2) grafisch ontwerp (3) geschiedenis van het schrift (4) het uitgeven van boeken (5) redactioneel ontwerp (6) geschiedenis en technologie van het drukken (7) schriftsystemen, schriften en talen (8) kalligrafie.</p><p><br></p><p>Stel een document samen met puntkomma-gescheiden records zoals deze (één record per regel):</p><p>ISBN;Volledige naam van de auteur;Boektitel;Jaar van publicatie;Taal van publicatie;Aantekeningen en opmerkingen</p><p><br></p><p>Neem alleen boeken op die daadwerkelijk bestaan, en alleen die algemeen als goed worden beschouwd. Controleer dit extra goed.</p></div><div class="ql-clipboard" contenteditable="true" tabindex="-1"></div></rich-textarea><!----><!----></div></div></div><div _ngcontent-ng-c4202497522="" class="leading-actions-wrapper ng-tns-c4202497522-6 ng-star-inserted"><div _ngcontent-ng-c4202497522="" class="uploader-button-container ng-tns-c4202497522-6 ng-star-inserted"><uploader-signed-out-tooltip _ngcontent-ng-c4202497522="" class="ng-tns-c4202497522-6" _nghost-ng-c208046529=""><!----></uploader-signed-out-tooltip><uploader _ngcontent-ng-c4202497522="" maticonprefix="" class="upload-button ng-tns-c4202497522-6" _nghost-ng-c15563704=""><div _ngcontent-ng-c15563704="" cdk-overlay-origin="" class="file-uploader ng-star-inserted"><div _ngcontent-ng-c15563704="" class="mat-mdc-tooltip-trigger mat-mdc-tooltip-disabled"><!----><button _ngcontent-ng-c15563704="" mat-icon-button="" color="primary" aria-label="Open upload file menu" class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base mat-mdc-tooltip-trigger upload-card-button open mat-primary _mat-animation-noopable ng-star-inserted" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-centered="" mat-ripple-loader-disabled="" jslog="188890;track:generic_click,impression,hover" aria-describedby="cdk-describedby-message-ng-1-3" cdk-describedby-host="ng-1"><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><mat-icon _ngcontent-ng-c15563704="" role="img" class="mat-icon notranslate gds-icon-l google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="add_2" fonticon="add_2"></mat-icon><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----><!----><!----></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!----><!----><!----><button _ngcontent-ng-c15563704="" tabindex="-1" xapfileselectortrigger="" aria-hidden="true" data-test-id="hidden-local-image-upload-button" class="hidden-local-upload-button"></button><button _ngcontent-ng-c15563704="" tabindex="-2" xapfileselectortrigger="" aria-hidden="true" data-test-id="hidden-local-file-upload-button" class="hidden-local-file-upload-button"></button></uploader></div><!----><!----><!----><toolbox-drawer _ngcontent-ng-c4202497522="" _nghost-ng-c2419590215="" class="ng-tns-c2419590215-15 ng-tns-c4202497522-6 ng-star-inserted" style=""><div _ngcontent-ng-c2419590215="" class="toolbox-drawer-container ng-tns-c2419590215-15 ng-trigger ng-trigger-toolboxDrawerEnter" jslog="251251;track:impression"><!----><div _ngcontent-ng-c2419590215="" cdkoverlayorigin="" class="toolbox-drawer-button-container ng-tns-c2419590215-15 ng-star-inserted" style=""><button _ngcontent-ng-c2419590215="" mat-icon-button="" class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base toolbox-drawer-button toolbox-drawer-button-with-label ng-tns-c2419590215-15 has-selected-item mat-unthemed _mat-animation-noopable ng-star-inserted" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-centered="" mat-ripple-loader-disabled="" aria-label="Tools" style=""><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><mat-icon _ngcontent-ng-c2419590215="" role="img" fonticon="page_info" class="mat-icon notranslate gds-icon-l google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="page_info"></mat-icon><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----><!----><button _ngcontent-ng-c2419590215="" mat-button="" class="mdc-button mat-mdc-button-base toolbox-drawer-item-deselect-button mat-mdc-button ng-tns-c2419590215-15 mat-unthemed _mat-animation-noopable ng-star-inserted" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" aria-label="Deselect Deep Research" style=""><span class="mat-mdc-button-persistent-ripple mdc-button__ripple"></span><mat-icon _ngcontent-ng-c2419590215="" role="img" class="mat-icon notranslate gds-icon-l toolbox-drawer-button-icon google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="travel_explore" fonticon="travel_explore"></mat-icon><span class="mdc-button__label"><span _ngcontent-ng-c2419590215="" class="toolbox-drawer-item-deselect-button-label">Deep Research</span></span><mat-icon _ngcontent-ng-c2419590215="" role="img" fonticon="close" iconpositionend="" class="mat-icon notranslate gds-icon-l google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="close"></mat-icon><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----><!----><!----></div><!----><!----><!----></div></toolbox-drawer><!----><!----><!----><!----></div><!----><div _ngcontent-ng-c4202497522="" class="input-buttons-wrapper-top ng-tns-c4202497522-6 ng-star-inserted"><div _ngcontent-ng-c4202497522="" class="fullscreen-button-container ng-tns-c4202497522-6 ng-star-inserted visible"><button _ngcontent-ng-c4202497522="" mat-icon-button="" mattooltip="Fullscreen" color="primary" aria-label="Expand input to Fullscreen" class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base mat-mdc-tooltip-trigger fullscreen-button ng-tns-c4202497522-6 mat-primary _mat-animation-noopable" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-centered="" aria-describedby="cdk-describedby-message-ng-1-59" cdk-describedby-host="ng-1"><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><mat-icon _ngcontent-ng-c4202497522="" role="img" class="mat-icon notranslate gds-icon-l google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="expand_content" fonticon="expand_content"></mat-icon><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----></div><!----></div><!----><div _ngcontent-ng-c4202497522="" class="trailing-actions-wrapper ng-tns-c4202497522-6"><!----><div _ngcontent-ng-c4202497522="" class="input-buttons-wrapper-bottom ng-tns-c4202497522-6"><div _ngcontent-ng-c4202497522="" class="mic-button-container ng-tns-c4202497522-6 ng-trigger ng-trigger-slide ng-star-inserted hidden"><speech-dictation-mic-button _ngcontent-ng-c4202497522="" class="speech-dictation-mic-button ng-tns-c833376002-7 ng-tns-c4202497522-6 ng-star-inserted" _nghost-ng-c833376002="" style=""><button _ngcontent-ng-c833376002="" data-node-type="speech_dictation_mic_button" maticonsuffix="" mat-icon-button="" mattooltip="Use microphone" aria-label="Microphone" class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base mat-mdc-tooltip-trigger speech_dictation_mic_button ng-tns-c833376002-7 mat-unthemed _mat-animation-noopable" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-centered="" jslog="175863;track:generic_click,impression" aria-describedby="cdk-describedby-message-ng-1-4" cdk-describedby-host="ng-1"><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><div _ngcontent-ng-c833376002=""><mat-icon _ngcontent-ng-c833376002="" role="img" class="mat-icon notranslate ng-tns-c833376002-7 icon-filled gds-icon-l google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="mic" fonticon="mic"></mat-icon><!----><!----></div><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----></speech-dictation-mic-button><!----></div><!----><div _ngcontent-ng-c4202497522="" class="mat-mdc-tooltip-trigger send-button-container ng-tns-c4202497522-6 inner ng-star-inserted visible" aria-describedby="cdk-describedby-message-ng-1-58" cdk-describedby-host="ng-1"><button _ngcontent-ng-c4202497522="" mat-icon-button="" class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base send-button ng-tns-c4202497522-6 submit mat-unthemed _mat-animation-noopable" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-centered="" aria-label="Send message" jslog="173899;track:generic_click,impression;BardVeMetadataKey:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[&quot;4af6c7f5da75d65d&quot;]];mutable:true" aria-disabled="false" tabindex="0"><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><mat-icon _ngcontent-ng-c4202497522="" role="img" fonticon="send" class="mat-icon notranslate send-button-icon icon-filled gds-icon-xl google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="send"></mat-icon><!----><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span><span class="mat-ripple mat-mdc-button-ripple"></span></button></div><!----><!----></div></div><!----></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></input-area-v2><!----></div><!----><hallucination-disclaimer _ngcontent-ng-c637212676="" aligntext="center" class="hallucination-disclaimer ng-tns-c637212676-2" _nghost-ng-c527061895=""><div _ngcontent-ng-c527061895="" class="capabilities-disclaimer" style="--align-text: center;"><!----><!----><p _ngcontent-ng-c527061895="" data-test-id="empty-disclaimer" class="gds-label-m-alt empty-disclaimer desktop-spacing ng-star-inserted"><br _ngcontent-ng-c527061895="" class="ng-star-inserted"><!----></p><!----><!----></div><!----><!----><!----><!----><!----><!----><!----></hallucination-disclaimer></input-container>
    await page.get_by_role("button", name="Tools").click()
    await page.get_by_role("button", name="Deep Research").click()
    await page.get_by_role("button", name="Send message").click()
    ## This is just an example, the page actually redirects
    await page.goto("https://gemini.google.com/u/0/app/f780e6d8fdffc093")
    ## We wait as Google works on this
    ## Once the deep research confirmation appears, we need to confirm it, example:<deep-research-confirmation-widget _nghost-ng-c3829334369="" class="ng-star-inserted" style=""><div _ngcontent-ng-c3829334369="" hide-from-message-actions="" class="container hide-from-message-actions ng-star-inserted"><div _ngcontent-ng-c3829334369="" data-test-id="title" class="gds-title-m"> Nederlandstalige Boeken: Typografie en Ontwerp </div><div _ngcontent-ng-c3829334369="" data-test-id="research-steps" class="research-steps ng-star-inserted"><div _ngcontent-ng-c3829334369="" class="research-step ng-star-inserted"><div _ngcontent-ng-c3829334369="" class="research-step-title gds-title-s"><mat-icon _ngcontent-ng-c3829334369="" role="img" fonticon="select_window_2" aria-label="The plan has 3 steps, 1st step" class="mat-icon notranslate icon google-symbols mat-ligature-font mat-icon-no-color ng-star-inserted" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="select_window_2"></mat-icon><!----><!----><!----><!----><div _ngcontent-ng-c3829334369="">Websites onderzoeken</div></div><div _ngcontent-ng-c3829334369="" class="research-step-description-wrapper gds-body-m"><div _ngcontent-ng-c3829334369="" class="research-step-description ng-star-inserted"><span _ngcontent-ng-c3829334369="">...</span></div><div _ngcontent-ng-c3829334369="" class="toggle-description-expansion-div ng-star-inserted"><button _ngcontent-ng-c3829334369="" mat-button="" data-test-id="toggle-description-expansion-button" class="mdc-button mat-mdc-button-base toggle-description-expansion-button mat-mdc-button mat-unthemed _mat-animation-noopable" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" jslog="264375;track:generic_click,impression;BardVeMetadataKey:[[&quot;r_4dcd4b2e039739ec&quot;,&quot;c_d2ec2327ab659941&quot;,null,null,null,null,null,null,1,null,null,null,0]];mutable:true"><span class="mat-mdc-button-persistent-ripple mdc-button__ripple"></span><span class="mdc-button__label"><span _ngcontent-ng-c3829334369="" aria-label="Show more">More</span></span><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button></div><!----><!----></div></div><div _ngcontent-ng-c3829334369="" class="research-step ng-star-inserted"><div _ngcontent-ng-c3829334369="" class="research-step-title gds-title-s"><!----><mat-icon _ngcontent-ng-c3829334369="" role="img" fonticon="sort" aria-label="2nd step" class="mat-icon notranslate icon google-symbols mat-ligature-font mat-icon-no-color ng-star-inserted" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="sort"></mat-icon><!----><!----><!----><div _ngcontent-ng-c3829334369="">Resultaten analyseren</div></div><div _ngcontent-ng-c3829334369="" class="research-step-description-wrapper gds-body-m"><!----></div></div><div _ngcontent-ng-c3829334369="" class="research-step ng-star-inserted"><div _ngcontent-ng-c3829334369="" class="research-step-title gds-title-s"><!----><!----><mat-icon _ngcontent-ng-c3829334369="" role="img" fonticon="travel_explore" aria-label="3rd-step" class="mat-icon notranslate icon google-symbols mat-ligature-font mat-icon-no-color ng-star-inserted" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="travel_explore"></mat-icon><!----><!----><div _ngcontent-ng-c3829334369="">Rapport maken</div></div><div _ngcontent-ng-c3829334369="" class="research-step-description-wrapper gds-body-m"><!----></div></div><!----></div><!----><div _ngcontent-ng-c3829334369="" data-test-id="time-estimation-message" class="time-estimation-message gds-body-m ng-star-inserted"><mat-icon _ngcontent-ng-c3829334369="" role="img" fonticon="schedule" aria-label="estimated time" class="mat-icon notranslate icon google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="schedule"></mat-icon><div _ngcontent-ng-c3829334369="">Klaar over een paar minuten</div></div><!----><div _ngcontent-ng-c3829334369="" class="action-button-wrapper ng-star-inserted"><button _ngcontent-ng-c3829334369="" mat-stroked-button="" color="primary" data-test-id="edit-button" class="mdc-button mat-mdc-button-base edit-button mdc-button--outlined mat-mdc-outlined-button mat-primary _mat-animation-noopable ng-star-inserted" mat-ripple-loader-class-name="mat-mdc-button-ripple" aria-label="Onderzoeksplan aanpassen" jslog="264373;track:generic_click,impression;BardVeMetadataKey:[[&quot;r_4dcd4b2e039739ec&quot;,&quot;c_d2ec2327ab659941&quot;,null,null,null,null,null,null,1,null,null,null,0]];mutable:true"><span class="mat-mdc-button-persistent-ripple mdc-button__ripple"></span><span class="mdc-button__label"> Plan aanpassen </span><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span><span class="mat-ripple mat-mdc-button-ripple"></span></button><!----><button _ngcontent-ng-c3829334369="" mat-flat-button="" color="primary" data-test-id="confirm-button" class="mdc-button mat-mdc-button-base confirm-button mdc-button--unelevated mat-mdc-unelevated-button mat-primary _mat-animation-noopable ng-star-inserted" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" aria-label="Onderzoek starten" jslog="264374;track:generic_click,impression;BardVeMetadataKey:[[&quot;r_4dcd4b2e039739ec&quot;,&quot;c_d2ec2327ab659941&quot;,null,null,null,null,null,null,1,null,null,null,0]];mutable:true"><span class="mat-mdc-button-persistent-ripple mdc-button__ripple"></span><span class="mdc-button__label"> Onderzoek starten </span><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----></div><!----></div><retry-without-tool-button _ngcontent-ng-c3829334369="" class="retry-without-tool ng-star-inserted" _nghost-ng-c1098755581="" jslog="264374;track:generic_click,impression;BardVeMetadataKey:[[&quot;r_4dcd4b2e039739ec&quot;,&quot;c_d2ec2327ab659941&quot;,null,null,null,null,null,null,1,null,null,null,0]];mutable:true"><button _ngcontent-ng-c1098755581="" mat-button="" class="mdc-button mat-mdc-button-base retry-without-tool-button mat-mdc-button mat-unthemed _mat-animation-noopable ng-star-inserted" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" jslog="253022;track:generic_click,impression"><span class="mat-mdc-button-persistent-ripple mdc-button__ripple"></span><span class="mdc-button__label"> Try again without Deep Research </span><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----></retry-without-tool-button><!----><!----></deep-research-confirmation-widget>
    await page.locator('[data-test-id="confirm-button"]').click()
    ## It looks like <button _ngcontent-ng-c3829334369="" mat-flat-button="" color="primary" data-test-id="confirm-button" class="mdc-button mat-mdc-button-base confirm-button mdc-button--unelevated mat-mdc-unelevated-button mat-primary _mat-animation-noopable ng-star-inserted" mat-ripple-loader-class-name="mat-mdc-button-ripple" aria-label="Onderzoek starten" jslog="264374;track:generic_click,impression;BardVeMetadataKey:[[&quot;r_4dcd4b2e039739ec&quot;,&quot;c_d2ec2327ab659941&quot;,null,null,null,null,null,null,1,null,null,null,0]];mutable:true"><span class="mat-mdc-button-persistent-ripple mdc-button__ripple"></span><span class="mdc-button__label"> Onderzoek starten </span><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span><span class="mat-ripple mat-mdc-button-ripple"></span></button>
    ## Then #app-root > main > side-navigation-v2 > bard-sidenav-container > bard-sidenav-content > div.content-wrapper > div > div.content-container > chat-window > immersive-panel > deep-research-immersive-panel  will appear ans we need to wait for several minutes or even many minutes.
    await page.locator('[data-test-id="export-menu-button"]').click()
    ## Instead of copying the button, we need to wait until it becomes available
    await page.get_by_role("menuitem", name="Copy").click()
    ## and then we grap the content of a div that emerges like <deep-research-immersive-panel _ngcontent-ng-c4265021602="" _nghost-ng-c2027632207="" class="ng-tns-c2027632207-26 ng-star-inserted" style=""><toolbar _ngcontent-ng-c2027632207="" class="ng-tns-c2027632207-26" _nghost-ng-c924707460=""><div _ngcontent-ng-c924707460="" class="toolbar has-title"><!----><div _ngcontent-ng-c924707460="" class="left-panel"><!----><!----><!----><mat-icon _ngcontent-ng-c924707460="" role="img" data-test-id="immersive-icon" class="mat-icon notranslate gds-icon-l google-symbols mat-ligature-font mat-icon-no-color ng-star-inserted" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="travel_explore" fonticon="travel_explore" style=""></mat-icon><!----><h2 _ngcontent-ng-c924707460="" class="title-text gds-title-s ng-star-inserted" style="">Slovenská knižná ... style="--skeleton-animation-delay: 0ms;"></div><div _ngcontent-ng-c490065506="" class="_index_1 item-line ng-star-inserted" style="--skeleton-animation-delay: 100ms;"></div><div _ngcontent-ng-c490065506="" class="_index_2 item-line ng-star-inserted" style="--skeleton-animation-delay: 200ms;"></div><div _ngcontent-ng-c490065506="" class="_index_3 item-line ng-star-inserted" style="--skeleton-animation-delay: 300ms;"></div><!----></div></div><div _ngcontent-ng-c490065506="" class="item-container ng-star-inserted" style=""><div _ngcontent-ng-c490065506="" class="item-side"><mat-divider _ngcontent-ng-c490065506="" role="separator" class="mat-divider item-side-line mat-divider-vertical" aria-orientation="vertical"></mat-divider></div><div _ngcontent-ng-c490065506="" class="item-row"><div _ngcontent-ng-c490065506="" class="_index_0 item-line ng-star-inserted" style="--skeleton-animation-delay: 0ms;"></div><div _ngcontent-ng-c490065506="" class="_index_1 item-line ng-star-inserted" style="--skeleton-animation-delay: 100ms;"></div><div _ngcontent-ng-c490065506="" class="_index_2 item-line ng-star-inserted" style="--skeleton-animation-delay: 200ms;"></div><div _ngcontent-ng-c490065506="" class="_index_3 item-line ng-star-inserted" style="--skeleton-animation-delay: 300ms;"></div><!----></div></div><!----></thinking-panel-skeleton-loader></div></thinking-panel><!----></div></div><!----><div _ngcontent-ng-c177129711="" class="response-container-footer ng-tns-c177129711-32"></div></div><!----></response-container><!----><!----></div><!----><!----></deep-research-immersive-panel>
    await page.locator('[data-test-id="scroll-container"]').click()
    ## And we convert it to Markdown with html2text and we return

    # ---------------------
    await context.close()
    await browser.close()


async def main() -> None:
    async with async_playwright() as playwright:
        await run(playwright)


asyncio.run(main())
